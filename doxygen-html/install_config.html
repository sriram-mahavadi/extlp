<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ExtLP: Disk Configuration Files</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ExtLP
   &#160;<span id="projectnumber">1.0-dev</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('install_config.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Disk Configuration Files </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="author"><dt><b>Author:</b></dt><dd>Timo Bingmann (2013)</dd></dl>
<p>A main feature of the STXXL is to take advantage of parallel access to <b>multiple disks</b>. For this, you must define the disk configuration in a text file, using the syntax described below. If no file is found at the locations below, STXXL will by default create a 1000 MiB file in <code>/var/tmp/stxxl</code> on Unix or in the user's temp directory on Windows.</p>
<p>These are the locations STXXL will look for a disk configuration file on <b>Linux/Unix systems</b>, in order of precedence:</p>
<ul>
<li>If the environment variable <b><code>STXXLCFG</code></b> specifies a file, this is used.</li>
<li>Then the current directory of the program is checked:<ul>
<li>first for <b><code>.stxxl.$HOSTNAME</code></b> (for host specific configuration),</li>
<li>then for <b><code>.stxxl</code></b> (for general configuration).</li>
</ul>
</li>
<li>Then the <code>$HOME</code> directory of the current user is checked (<b>usual method</b>):<ul>
<li>first for <b><code>$HOME/.stxxl.$HOSTNAME</code></b> (for host specific configuration),</li>
<li>then for <b><code>$HOME/.stxxl</code></b> (for general configuration).</li>
</ul>
</li>
</ul>
<dl class="warning"><dt><b>Warning:</b></dt><dd>On many Linux distributions the <code>$HOSTNAME</code> variable is not exported. For the host specific configuration to work, you must add <code>"export HOSTNAME"</code> to your shell configuration (<code>.bashrc</code>).</dd></dl>
<p>On <b>Windows systems</b>, STXXL looks for a disk configuration file in the following directories:</p>
<ul>
<li>If the environment variable <b><code>STXXLCFG</code></b> specifies a file, this is used.</li>
<li>Then the current directory of the program is checked:<ul>
<li>first for <b><code>.stxxl.%COMPUTERNAME%.txt</code></b> (for host specific configuration),</li>
<li>then for <b><code>.stxxl.txt</code></b> (for general configuration).</li>
</ul>
</li>
<li>Then the <code>%APPDATA%</code> directory of the current user is checked (<b>usual method</b>):<ul>
<li>first for <b><code>%APPDATA%/.stxxl.%COMPUTERNAME%.txt</code></b> (for host specific configuration),</li>
<li>then for <b><code>%APPDATA%/.stxxl.txt</code></b> (for general configuration).</li>
</ul>
</li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>In a default Windows 7 installation, %APPDATA% is <b><code>C:\Users\<em>&lt;username&gt;</em>\AppData\Roaming</code></b> <br/>
 You can visit your <code>%APPDATA%</code> directory by simply entering <b><code>"%APPDATA%"</code></b> in the Windows Explorer address/location line.</dd></dl>
<h2><a class="anchor" id="install_config_format"></a>
Disk Configuration File Format</h2>
<p>Each line of the configuration file describes a disk. Lines starting with '#' are comments.</p>
<p>A disk description uses the following format: </p>
<div class="fragment"><pre class="fragment">
disk=&lt;path&gt;,&lt;capacity&gt;,&lt;fileio&gt; &lt;options&gt;
</pre></div><p>Description of the parameters:</p>
<ul>
<li><code>&lt;path&gt;</code> : full disk filename.<ul>
<li>In order to access disks STXXL uses <em>file-based access methods</em> (see below). Each disk is represented as a file</li>
<li>If you have a disk that is mounted in Unix to the path /mnt/disk0/, then the correct value for the <code>full_disk_filename</code> would be <code>/mnt/disk0/some_file_name</code>. <br/>
</li>
<li>If the string contains <code>"###"</code> (three '#'), then these symbols are replaced by the current process id.</li>
</ul>
</li>
</ul>
<ul>
<li><code>&lt;capacity&gt;</code> : maximum capacity of the disk</li>
</ul>
<ul>
<li>the following size suffixes are recognized:<ul>
<li><code>K</code>, <code>M</code>, <code>G</code>, <code>T</code>, <code>P</code> (powers of 10),</li>
<li><code>Ki</code>, <code>Mi</code>, <code>Gi</code>, <code>Ti</code>, <code>Pi</code> (powers of 2).</li>
<li>if a number has no suffix, <code>M</code> (megabyte) is assumed.</li>
</ul>
</li>
</ul>
<ul>
<li>0 means autogrow, and the file will be deleted afterwards.</li>
</ul>
<ul>
<li><code>&lt;fileio&gt;</code> : <code>STXXL</code> has a number of different file access implementations, choose one of them:</li>
</ul>
<ul>
<li><code>syscall</code> : use <code>read</code> and <code>write</code> system calls which perform disk transfers directly on user memory pages without superfluous copying (currently the fastest method)</li>
</ul>
<ul>
<li><code>wincall</code> : on Windows, use direct calls to the Windows API.</li>
</ul>
<ul>
<li><code>memory</code> : keeps all data in RAM, for quicker testing</li>
</ul>
<ul>
<li><code>mmap</code> : <code>use</code> <code>mmap</code> and <code>munmap</code> system calls</li>
</ul>
<ul>
<li><code>boostfd</code> : access the file using a Boost file descriptor</li>
</ul>
<ul>
<li><code>fileperblock_syscall</code>, <code>fileperblock_mmap</code>, <code>fileperblock_boostfd</code> : same as above, but take a single file per block, using full_disk_filename as file name prefix. Usually provide worse performance than the standard variants, but release freed blocks to the file system immediately.</li>
</ul>
<ul>
<li><code>simdisk</code> : simulates timings of the IBM IC35L080AVVA07 disk, full_disk_filename must point to a file on a RAM disk partition with sufficient space</li>
</ul>
<ul>
<li><code>wbtl</code> : library-based write-combining (good for writing small blocks onto SSDs), based on <code>syscall</code> </li>
</ul>
<ul>
<li><code>&lt;options&gt;</code> : additional options for file access implementation. Not all are available for every fileio method. The option order is unimportant.</li>
</ul>
<ul>
<li><code>autogrow</code> : enables automatic growth of the file beyond the specified capacity.</li>
</ul>
<ul>
<li><code>direct</code>, <code>nodirect</code>, <code>direct=</code>[off/try/on] : disable buffering in system cache by passing O_DIRECT or similar flag to open. <br/>
 This is <em>recommended</em> as it improves performance, however, not all filesystems support bypassing cache. With <code>direct</code> or <code>direct=on</code>, STXXL will fail without direct access. With <code>nodirect</code> or <code>direct=off</code> it is disabled. The default is <code>direct=try</code> , which first attempts to open with O_DIRECT and falls back to opening without if it fails.</li>
</ul>
<ul>
<li><code>unlink</code> (or <code>unlink_on_open</code>) : unlink the file from the fs immediately after creation. <br/>
 This is possible on Unix system, as the file descriptor is kept open. This method is <b>preferred</b>, because even in the case of a program segfault, the file data is cleaned up by the kernel.</li>
</ul>
<ul>
<li><code>delete</code> (or <code>delete_on_exit</code>) : delete file <em>after</em> the STXXL program exists <br/>
 This is the more conservative version of unlink, which also works on Windows. However, if the program crashes, the file is not deleted.</li>
</ul>
<ul>
<li><code>raw_device</code> : fail if the opened path is not a raw block device. <br/>
 This flag is not required, raw devices are automatically detected.</li>
</ul>
<ul>
<li><code>queue=#</code> : assign the disk to a specific I/O request queue and thread. <br/>
 Use this for multiple files that reside on the same physical disk.</li>
</ul>
<p>Example: </p>
<div class="fragment"><pre class="fragment">
disk=/data01/stxxl,500G,syscall unlink
disk=/data02/stxxl,300G,syscall unlink
</pre></div><p>On Windows, one usually uses different disk drives and <code>wincall</code>. </p>
<div class="fragment"><pre class="fragment">
disk=c:\stxxl.tmp,700G,wincall delete
disk=d:\stxxl.tmp,200G,wincall delete
</pre></div><h2><a class="anchor" id="install_config_filesystem"></a>
Recommended: File System XFS or Raw Block Devices</h2>
<p>The library benefits from direct transfers from user memory to disk, which saves superfluous copies. We recommend to use the <a href="http://xfs.org">XFS file system</a>, which gives good read and write performance for large files. Note that file creation speed of <code>XFS</code> is a bit slower, so that disk files should be precreated for optimal performance.</p>
<p>If the filesystems only use is to store one large STXXL disk file, we also recommend to add the following options to the <code>mkfs.xfs</code> command to gain maximum performance: </p>
<div class="fragment"><pre class="fragment">
$ mkfs.xfs -d agcount=1 -l size=512b
</pre></div><p>The following filesystems have been reported not to support direct I/O: <code>tmpfs</code> , <code>glusterfs</code> . By default, STXXL will first try to use direct I/O (<code>O_DIRECT</code> open flag). If that fails, it will print a warning and open the file without <code>O_DIRECT</code>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>It is also possible to use <b>raw disk devices</b> with <code>syscall</code>. <br/>
 Just use <code>disk=/dev/sdb1</code> or similar. This will of course <b>overwrite</b> all data on the partitions! The I/O performance of raw disks is generally <b>more stable and slightly higher</b> than with file systems. <div class="fragment"><pre class="fragment">disk=/dev/sdb1,0,syscall raw_device
</pre></div> The <code>raw_device</code> flag is only for verification, STXXL will automatically detect raw block devices and also their size.</dd></dl>
<h2><a class="anchor" id="install_config_logfiles"></a>
Log Files</h2>
<p>STXXL produces two kinds of log files, a message and an error log. By setting the environment variables <code>STXXLLOGFILE</code> and <code>STXXLERRLOGFILE</code>, you can configure the location of these files. The default values are <code>stxxl.log</code> and <code>stxxl.errlog</code>, respectively.</p>
<h2><a class="anchor" id="install_config_precreation"></a>
Precreating External Memory Files</h2>
<p>In order to get the maximum performance one can precreate disk files described in the configuration file, before running STXXL applications. A precreation utility is included in the set of STXXL utilities in <code>stxxl_tool</code>. Run this utility for each disk you have defined in the disk configuration file: </p>
<div class="fragment"><pre class="fragment">
$ stxxl_tool create_files &lt;capacity&gt; &lt;full_disk_filename...&gt;
// for example:
$ stxxl_tool create_files 1GiB /data01/stxxl
</pre></div><h2><a class="anchor" id="install_config_user"></a>
User-Supplied disk_config Structures</h2>
<p>With STXXL &gt;= 1.4.0, the library can also be configured via the user application.</p>
<p>All disk configuration is managed by the stxxl::config class, which contains a list of stxxl::disk_config objects. Each stxxl::disk_config object encapsulates one disk= lines from a config file, or one allocated disk.</p>
<p>The disk configuration must be supplied to the STXXL library <b>before any other function calls</b>, because the stxxl::config object must be filled before any external memory blocks are allocated by stxxl::block_manager.</p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">int</span> <a class="code" href="extlp_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()
{
    <span class="comment">// get uninitialized config singleton</span>
    stxxl::config * cfg = stxxl::config::get_instance();

    <span class="comment">// create a disk_config structure.</span>
    stxxl::disk_config disk1(<span class="stringliteral">&quot;/tmp/stxxl.tmp&quot;</span>, 100 * 1024 * 1024, <span class="stringliteral">&quot;syscall unlink&quot;</span>);
    disk1.direct = stxxl::disk_config::DIRECT_ON; <span class="comment">// force O_DIRECT</span>

    <span class="comment">// add disk to config</span>
    config-&gt;add_disk(disk1);

    <span class="comment">// add another disk</span>
    config-&gt;add_disk( disk_config(<span class="stringliteral">&quot;disk=/tmp/stxxl-2.tmp, 10 GiB, syscall unlink&quot;</span>) );

    <span class="comment">// ... add more disks</span>

    <span class="comment">// use STXXL library as usual ...</span>
}
</pre></div> </div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="install.html">Compilation and Configuration</a>      </li>

    <li class="footer">Generated on Sat Jun 14 2014 01:55:17 for ExtLP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
